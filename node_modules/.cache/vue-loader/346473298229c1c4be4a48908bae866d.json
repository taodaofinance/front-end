{"remainingRequest":"C:\\GitCrypto\\front_end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\GitCrypto\\front_end\\src\\components\\Modal\\Revitalize.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\GitCrypto\\front_end\\src\\components\\Modal\\Revitalize.vue","mtime":1620499713479},{"path":"C:\\GitCrypto\\front_end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\GitCrypto\\front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\GitCrypto\\front_end\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBtYXBBY3Rpb25zLCBtYXBTdGF0ZSB9IGZyb20gJ3Z1ZXgnOw0KaW1wb3J0IHsgZ2V0QlMsIGZvcm1hdFRzLCBnZXRNaW5EYXksIGdldERlcGxveW1lbnRUaW1lc3RhbXAgfSBmcm9tICdAL2hlbHBlcnMvdXRpbHMnOw0KaW1wb3J0IGNvaW5nZWNrbyBmcm9tICdAL2hlbHBlcnMvY29pbmdlY2tvLmpzb24nOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIHByb3BzOiBbJ29wZW4nLCAnZm9ybSddLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBzdGVwOiAwLA0KICAgICAgaXNJbml0OiBmYWxzZSwNCiAgICAgIGlzQXBwcm92ZWQ6IGZhbHNlLA0KICAgICAgaXNDb25maXJtZWQ6IGZhbHNlLA0KICAgICAgaXNMb2FkaW5nOiBmYWxzZSwNCiAgICAgIHF1YW50aXR5OiAnJywNCiAgICAgIGF1dG9QcmljZTogdHJ1ZSwNCiAgICAgIGF1dG9QcmljZVBlclBvdGlvbjogdHJ1ZSwNCiAgICAgIHByaWNlOiAnJywNCiAgICAgIHByaWNlUGVyUG90aW9uOiAnJywNCiAgICAgIGNvaW5nZWNrbw0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgLi4ubWFwU3RhdGUoWydzZXR0aW5ncyddKSwNCiAgICBjdXJyZW50UHJpY2UoKSB7DQogICAgICBjb25zdCBhc3NldCA9IGNvaW5nZWNrb1t0aGlzLmZvcm0ucG90aW9uLmFzc2V0XTsNCiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLmV4Y2hhbmdlUmF0ZXNbYXNzZXRdICYmIHRoaXMuc2V0dGluZ3MuZXhjaGFuZ2VSYXRlc1thc3NldF0udXNkDQogICAgICAgID8gdGhpcy5zZXR0aW5ncy5leGNoYW5nZVJhdGVzW2Fzc2V0XS51c2QudG9GaXhlZCgyKQ0KICAgICAgICA6IDA7DQogICAgfSwNCiAgICBhdmFpbGFibGVRdWFudGl0eSgpIHsNCiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLmJhbGFuY2VzW3RoaXMuZm9ybS5wb3Rpb24uYWRkcmVzc10gfHwgMDsNCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgYXN5bmMgb3Blbih2YWx1ZSwgb2xkVmFsdWUpIHsNCiAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSAmJiBvbGRWYWx1ZSA9PT0gZmFsc2UpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7DQogICAgICB9DQogICAgICB0aGlzLmF1dG9QcmljZSA9IHRydWU7DQogICAgICB0aGlzLnByaWNlID0gdGhpcy5jdXJyZW50UHJpY2U7DQogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KICAgICAgdGhpcy5pc0NvbmZpcm1lZCA9IGZhbHNlOw0KICAgICAgY29uc3QgYWxsb3dhbmNlID0gcGFyc2VGbG9hdCh0aGlzLnNldHRpbmdzLmFsbG93YW5jZXNbdGhpcy5mb3JtLnBvdGlvbi5hZGRyZXNzXSB8fCAnMCcpOw0KICAgICAgdGhpcy5pc0FwcHJvdmVkID0gISFhbGxvd2FuY2U7DQogICAgICB0aGlzLmlzQ29uZmlybWVkID0gZmFsc2U7DQogICAgICB0aGlzLnN0ZXAgPSAwOw0KICAgIH0sDQogICAgYXV0b1ByaWNlKHZhbHVlKSB7DQogICAgICBpZiAodmFsdWUpIHRoaXMucHJpY2UgPSB0aGlzLmN1cnJlbnRQcmljZTsNCiAgICB9LA0KICAgIHByaWNlKHZhbHVlLCBvbGRWYWx1ZSkgew0KICAgICAgaWYgKHZhbHVlICE9PSBvbGRWYWx1ZSAmJiB0aGlzLmF1dG9QcmljZVBlclBvdGlvbikgdGhpcy5pbml0KCk7DQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLi4ubWFwQWN0aW9ucyhbJ2FwcHJvdmVQb3Rpb24nLCAncmV2aXRhbGlzZVBvdGlvbicsICdsb2FkQmFsYW5jZUluJywgJ2dldEJTJ10pLA0KICAgIGFzeW5jIGhhbmRsZUFwcHJvdmVQb3Rpb24oKSB7DQogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7DQogICAgICB0cnkgew0KICAgICAgICBhd2FpdCB0aGlzLmFwcHJvdmVQb3Rpb24odGhpcy5mb3JtLnBvdGlvbi5hZGRyZXNzKTsNCiAgICAgICAgdGhpcy5pc0FwcHJvdmVkID0gdHJ1ZTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7DQogICAgfSwNCiAgICBhc3luYyBoYW5kbGVSZXZpdGFsaXNlUG90aW9uKCkgew0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOw0KICAgICAgY29uc3QgcGF5bG9hZCA9IHRoaXMuZm9ybS5wb3Rpb247DQogICAgICBwYXlsb2FkLnByaWNlID0gdGhpcy5wcmljZTsNCiAgICAgIHBheWxvYWQucXVhbnRpdHkgPSB0aGlzLnF1YW50aXR5Ow0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5zdGVwKys7DQogICAgICAgIGF3YWl0IHRoaXMucmV2aXRhbGlzZVBvdGlvbihwYXlsb2FkKTsNCiAgICAgICAgdGhpcy5zdGVwKys7DQogICAgICAgIHRoaXMuaXNDb25maXJtZWQgPSB0cnVlOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKGUpOw0KICAgICAgfQ0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsNCiAgICB9LA0KICAgIGFzeW5jIGluaXQoKSB7DQogICAgICB0aGlzLnF1YW50aXR5ID0gJyc7DQogICAgICB0aGlzLmF1dG9QcmljZSA9IHRydWU7DQogICAgICB0aGlzLnByaWNlID0gdGhpcy5jdXJyZW50UHJpY2U7DQogICAgICB0aGlzLnByaWNlUGVyUG90aW9uID0gJyc7DQoNCiAgICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpOw0KICAgICAgY29uc29sZS5sb2codGhpcy5mb3JtLnBvdGlvbi5hZGRyZXNzKTsNCiAgICAgIGF3YWl0IHRoaXMubG9hZEJhbGFuY2VJbih0aGlzLmZvcm0ucG90aW9uLmFkZHJlc3MpOw0KDQogICAgICBjb25zdCB0TWludGluZyA9IHBhcnNlSW50KGF3YWl0IGdldERlcGxveW1lbnRUaW1lc3RhbXAodGhpcy5mb3JtLnBvdGlvbi5jb250cmFjdEFkZHJlc3MpKTsNCiAgICAgIGNvbnNvbGUubG9nKCdUIG1pbnRpbmcnLCB0TWludGluZyk7DQoNCiAgICAgIGNvbnN0IHRMaXF1aWRpYXRpb24gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDAgKyA4NjQwMCAqIDU7DQogICAgICBjb25zb2xlLmxvZygnVCBsaXF1aWRpYXRpb24nLCB0TGlxdWlkaWF0aW9uKTsNCg0KICAgICAgY29uc3QgdCA9ICh0TGlxdWlkaWF0aW9uIC0gdE1pbnRpbmcpIC8gMzE1MzYwMDA7DQogICAgICBjb25zb2xlLmxvZygndCcsIHQpOyAvLyAwLjA0MTA5NTkNCg0KICAgICAgY29uc3QgdGlja2VyID0gY29pbmdlY2tvW3RoaXMuZm9ybS5wb3Rpb24uYXNzZXRdOw0KICAgICAgdGhpcy5icyA9IGF3YWl0IGdldEJTKA0KICAgICAgICB0aWNrZXIsDQogICAgICAgIHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCksDQogICAgICAgIHBhcnNlRmxvYXQodGhpcy5mb3JtLnBvdGlvbi5taW50QXByaWNlKSwNCiAgICAgICAgcGFyc2VGbG9hdCh0aGlzLmZvcm0ucG90aW9uLm1pbnRTcHJpY2UpLA0KICAgICAgICB0DQogICAgICApOw0KICAgICAgdGhpcy5wcmljZVBlclBvdGlvbiA9IHRoaXMuYnM7DQogICAgICB0aGlzLmlzSW5pdCA9IHRydWU7DQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["Revitalize.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8IA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Revitalize.vue","sourceRoot":"src/components/Modal","sourcesContent":["<template>\r\n  <Modal :open=\"open\" @close=\"$emit('close')\">\r\n    <div class=\"modal-body px-4\">\r\n      <div v-if=\"step === 0\">\r\n        <h2 class=\"mb-5\">Potion exercise</h2>\r\n        <div class=\"text-left\">\r\n          <div class=\"border-bottom mb-5\">\r\n            <div class=\"mb-4\">\r\n              Strike price<span class=\"float-right\">${{ $n(form.potion.mintSprice) }}</span>\r\n            </div>\r\n            <div class=\"mb-4\">\r\n              Expiry date<span class=\"float-right\">{{ form.potion.expiry | formatTs }}</span>\r\n            </div>\r\n            <div class=\"mb-4\">\r\n              Asset\r\n              <Ticker :id=\"coingecko[form.potion.asset]\" class=\"float-right\" />\r\n            </div>\r\n            <div class=\"mb-5\">\r\n              Available quantity<span class=\"float-right\" v-if=\"isInit\">\r\n                {{ availableQuantity }}</span\r\n              >\r\n            </div>\r\n          </div>\r\n          <h2 class=\"mb-5 text-center\">Balance revitalization</h2>\r\n          <div class=\"mb-4\">\r\n            <input type=\"number\" class=\"input\" placeholder=\"Quantity\" v-model=\"quantity\" />\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            Auto asset price\r\n            <span class=\"float-right\">\r\n              <VueSwitch v-model=\"autoPrice\" />\r\n            </span>\r\n          </div>\r\n          <div class=\"mb-4\">\r\n            <input\r\n              :readonly=\"autoPrice\"\r\n              type=\"number\"\r\n              class=\"input mb-3\"\r\n              placeholder=\"Price\"\r\n              v-model=\"price\"\r\n            />\r\n            <h6 v-if=\"!autoPrice\">\r\n              Using non-market prices may result in losses.\r\n              <a\r\n                href=\"https://potion.gitbook.io/docs/exercising-a-potion/buying-a-potion\"\r\n                target=\"_blank\"\r\n              >\r\n                Learn more\r\n              </a>\r\n            </h6>\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            Auto price per potion\r\n            <span class=\"float-right\">\r\n              <VueSwitch v-model=\"autoPricePerPotion\" />\r\n            </span>\r\n          </div>\r\n          <div class=\"mb-5\">\r\n            <input\r\n              :readonly=\"autoPricePerPotion\"\r\n              type=\"number\"\r\n              class=\"input mb-3\"\r\n              placeholder=\"Price per potion\"\r\n              v-model=\"pricePerPotion\"\r\n            />\r\n            <h6 v-if=\"!autoPricePerPotion\">\r\n              Using non-market prices may result in losses.\r\n              <a\r\n                href=\"https://potion.gitbook.io/docs/exercising-a-potion/buying-a-potion\"\r\n                target=\"_blank\"\r\n              >\r\n                Learn more\r\n              </a>\r\n            </h6>\r\n          </div>\r\n        </div>\r\n        <h2 class=\"mb-4\">Want to use?</h2>\r\n        <div class=\"d-flex mb-2\">\r\n          <button class=\"button button-outline col-6 mr-2\" @click=\"$emit('close')\">Cancel</button>\r\n          <button\r\n            class=\"button button-primary col-6 ml-2\"\r\n            v-if=\"!isApproved\"\r\n            :disabled=\"isLoading\"\r\n            @click=\"handleApprovePotion\"\r\n          >\r\n            <VueLoadingIndicator v-if=\"isLoading\" class=\"big\" />\r\n            <template v-else>Unlock {{ form.potion.asset }}POT</template>\r\n          </button>\r\n          <button\r\n            v-else\r\n            class=\"button button-primary col-6 ml-2\"\r\n            :disabled=\"!price || !quantity\"\r\n            @click=\"step = 1\"\r\n          >\r\n            Next\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div v-else-if=\"step === 1\">\r\n        <h2 class=\"mb-5\">Be careful</h2>\r\n        <p class=\"mb-5\">\r\n          In order to liquidate you must stake BUSD. If you entered wrong values and are disputed,\r\n          you may lose these as penalty.\r\n        </p>\r\n        <p class=\"mb-2\">Your stake</p>\r\n        <h1 class=\"text-primary mb-5\">5 BUSD</h1>\r\n        <h2 class=\"mb-5\">Want to proceed?</h2>\r\n        <div class=\"d-flex mb-2\">\r\n          <button class=\"button button-outline col-6 mr-2\" @click=\"$emit('close')\">Cancel</button>\r\n          <button\r\n            class=\"button button-primary col-6 ml-2\"\r\n            :disabled=\"isLoading\"\r\n            @click=\"handleRevitalisePotion\"\r\n          >\r\n            <VueLoadingIndicator v-if=\"isLoading\" class=\"big\" />\r\n            <template v-else>Confirm</template>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div v-else-if=\"step > 1\">\r\n        <h2 class=\"mb-5\">Hocus pocus!</h2>\r\n        <div v-if=\"step === 2\">\r\n          <VueLoadingIndicator class=\"loading-lg mb-5\" />\r\n          <h2 class=\"mb-5\" v-if=\"step === 2\">Sponsor is verifying…</h2>\r\n          <p class=\"mb-5\">Current price set to ${{ $n(price) }}</p>\r\n        </div>\r\n        <div v-if=\"step === 3\">\r\n          <img src=\"~/@/assets/check.svg\" height=\"118\" class=\"mb-5\" />\r\n          <h2 class=\"mb-5\">Revitalization went good!</h2>\r\n          <p class=\"mb-5\">BUSD available to be withdrawn.</p>\r\n        </div>\r\n        <div>\r\n          <a @click=\"$emit('close')\" class=\"col-6 button button-outline\">\r\n            Back to home\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </Modal>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions, mapState } from 'vuex';\r\nimport { getBS, formatTs, getMinDay, getDeploymentTimestamp } from '@/helpers/utils';\r\nimport coingecko from '@/helpers/coingecko.json';\r\n\r\nexport default {\r\n  props: ['open', 'form'],\r\n  data() {\r\n    return {\r\n      step: 0,\r\n      isInit: false,\r\n      isApproved: false,\r\n      isConfirmed: false,\r\n      isLoading: false,\r\n      quantity: '',\r\n      autoPrice: true,\r\n      autoPricePerPotion: true,\r\n      price: '',\r\n      pricePerPotion: '',\r\n      coingecko\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState(['settings']),\r\n    currentPrice() {\r\n      const asset = coingecko[this.form.potion.asset];\r\n      return this.settings.exchangeRates[asset] && this.settings.exchangeRates[asset].usd\r\n        ? this.settings.exchangeRates[asset].usd.toFixed(2)\r\n        : 0;\r\n    },\r\n    availableQuantity() {\r\n      return this.settings.balances[this.form.potion.address] || 0;\r\n    }\r\n  },\r\n  watch: {\r\n    async open(value, oldValue) {\r\n      if (value === true && oldValue === false) {\r\n        await this.init();\r\n      }\r\n      this.autoPrice = true;\r\n      this.price = this.currentPrice;\r\n      this.isLoading = false;\r\n      this.isConfirmed = false;\r\n      const allowance = parseFloat(this.settings.allowances[this.form.potion.address] || '0');\r\n      this.isApproved = !!allowance;\r\n      this.isConfirmed = false;\r\n      this.step = 0;\r\n    },\r\n    autoPrice(value) {\r\n      if (value) this.price = this.currentPrice;\r\n    },\r\n    price(value, oldValue) {\r\n      if (value !== oldValue && this.autoPricePerPotion) this.init();\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions(['approvePotion', 'revitalisePotion', 'loadBalanceIn', 'getBS']),\r\n    async handleApprovePotion() {\r\n      this.isLoading = true;\r\n      try {\r\n        await this.approvePotion(this.form.potion.address);\r\n        this.isApproved = true;\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      this.isLoading = false;\r\n    },\r\n    async handleRevitalisePotion() {\r\n      this.isLoading = true;\r\n      const payload = this.form.potion;\r\n      payload.price = this.price;\r\n      payload.quantity = this.quantity;\r\n      try {\r\n        this.step++;\r\n        await this.revitalisePotion(payload);\r\n        this.step++;\r\n        this.isConfirmed = true;\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      this.isLoading = false;\r\n    },\r\n    async init() {\r\n      this.quantity = '';\r\n      this.autoPrice = true;\r\n      this.price = this.currentPrice;\r\n      this.pricePerPotion = '';\r\n\r\n      console.log('================================');\r\n      console.log(this.form.potion.address);\r\n      await this.loadBalanceIn(this.form.potion.address);\r\n\r\n      const tMinting = parseInt(await getDeploymentTimestamp(this.form.potion.contractAddress));\r\n      console.log('T minting', tMinting);\r\n\r\n      const tLiquidiation = new Date().getTime() / 1000 + 86400 * 5;\r\n      console.log('T liquidiation', tLiquidiation);\r\n\r\n      const t = (tLiquidiation - tMinting) / 31536000;\r\n      console.log('t', t); // 0.0410959\r\n\r\n      const ticker = coingecko[this.form.potion.asset];\r\n      this.bs = await getBS(\r\n        ticker,\r\n        parseInt(new Date().getTime() / 1000),\r\n        parseFloat(this.form.potion.mintAprice),\r\n        parseFloat(this.form.potion.mintSprice),\r\n        t\r\n      );\r\n      this.pricePerPotion = this.bs;\r\n      this.isInit = true;\r\n    }\r\n  }\r\n};\r\n</script>\r\n"]}]}
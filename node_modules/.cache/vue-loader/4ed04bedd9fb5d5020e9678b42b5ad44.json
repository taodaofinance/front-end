{"remainingRequest":"C:\\GitCrypto\\front_end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\GitCrypto\\front_end\\src\\components\\Modal\\MakePotion.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\GitCrypto\\front_end\\src\\components\\Modal\\MakePotion.vue","mtime":1620499713478},{"path":"C:\\GitCrypto\\front_end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\GitCrypto\\front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\GitCrypto\\front_end\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYnMgZnJvbSAnYmxhY2stc2Nob2xlcyc7DQppbXBvcnQgeyBtYXBBY3Rpb25zLCBtYXBTdGF0ZSB9IGZyb20gJ3Z1ZXgnOw0KaW1wb3J0IHsgZ2V0UHJlbWl1bURlcG9zaXQgfSBmcm9tICcuLi8uLi9oZWxwZXJzL3V0aWxzJzsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogWydvcGVuJywgJ2Zvcm0nXSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgaXNDb21wbGV0ZWQ6IGZhbHNlLA0KICAgICAgaXNMb2FkaW5nOiBmYWxzZSwNCiAgICAgIGlzQXBwcm92ZWQ6IHRydWUsDQogICAgICBpc0NvbmZpcm1lZDogZmFsc2UsDQogICAgICBhdXRvUHJpY2U6IHRydWUsDQogICAgICBwcmljZTogMA0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgLi4ubWFwU3RhdGUoWydzZXR0aW5ncyddKSwNCiAgICBjdXJyZW50UHJpY2UoKSB7DQogICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5leGNoYW5nZVJhdGVzW3RoaXMuZm9ybS5hc3NldF0gJiYNCiAgICAgICAgdGhpcy5zZXR0aW5ncy5leGNoYW5nZVJhdGVzW3RoaXMuZm9ybS5hc3NldF0udXNkDQogICAgICAgID8gdGhpcy5zZXR0aW5ncy5leGNoYW5nZVJhdGVzW3RoaXMuZm9ybS5hc3NldF0udXNkLnRvRml4ZWQoMikNCiAgICAgICAgOiAwOw0KICAgIH0sDQogICAgZGF5c1RvRXhwaXJ5KCkgew0KICAgICAgY29uc3Qgb25lRGF5ID0gMjQgKiA2MCAqIDYwICogMWUzOw0KICAgICAgY29uc3QgW3llYXIsIG1vbnRoLCBkYXldID0gdGhpcy5mb3JtLmV4cGlyeS5zcGxpdCgnLScpOw0KICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpOw0KICAgICAgY29uc3QgZXhwaXJ5RGF0ZSA9IG5ldyBEYXRlKHBhcnNlSW50KHllYXIpLCBwYXJzZUludChtb250aCkgLSAxLCBwYXJzZUludChkYXkpICsgMSk7DQogICAgICByZXR1cm4gTWF0aC5yb3VuZChNYXRoLmFicygodG9kYXkgLSBleHBpcnlEYXRlKSAvIG9uZURheSkpOw0KICAgIH0sDQogICAgcHJlbWl1bURlcG9zaXQoKSB7DQogICAgICByZXR1cm4gZ2V0UHJlbWl1bURlcG9zaXQodGhpcy5mb3JtLnN0cmlrZSwgdGhpcy5wcmljZSwgdGhpcy5kYXlzVG9FeHBpcnkpOw0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC4uLm1hcEFjdGlvbnMoWydsb2dpbicsICdhcHByb3ZlJywgJ3dyaXRlTWludFBvdGlvbicsICdsb2FkUG90aW9ucyddKSwNCiAgICBhc3luYyBoYW5kbGVTdWJtaXQoKSB7DQogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7DQogICAgICBpZiAodGhpcy5pc0FwcHJvdmVkKSB7DQogICAgICAgIHRoaXMuaXNDb25maXJtZWQgPSB0cnVlOw0KICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KICAgICAgICBjb25zdCBwYXlsb2FkID0gew0KICAgICAgICAgIGFzc2V0OiB0aGlzLmZvcm0uYXNzZXQsDQogICAgICAgICAgc3RyaWtlOiB0aGlzLmZvcm0uc3RyaWtlLA0KICAgICAgICAgIGV4cGlyeTogdGhpcy5mb3JtLmV4cGlyeSwNCiAgICAgICAgICBxdWFudGl0eTogdGhpcy5mb3JtLnF1YW50aXR5LA0KICAgICAgICAgIHByaWNlOiB0aGlzLnByaWNlLA0KICAgICAgICAgIHByZW1pdW06IHRoaXMucHJlbWl1bURlcG9zaXQudG9TdHJpbmcoKQ0KICAgICAgICB9Ow0KICAgICAgICBhd2FpdCB0aGlzLndyaXRlTWludFBvdGlvbihwYXlsb2FkKTsNCiAgICAgICAgYXdhaXQgdGhpcy5sb2FkUG90aW9ucygpOw0KICAgICAgICB0aGlzLmlzQ29tcGxldGVkID0gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGF3YWl0IHRoaXMuYXBwcm92ZSgpOw0KICAgICAgICB0aGlzLmlzQXBwcm92ZWQgPSB0cnVlOw0KICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBvcGVuKCkgew0KICAgICAgdGhpcy5hdXRvUHJpY2UgPSB0cnVlOw0KICAgICAgdGhpcy5wcmljZSA9IHRoaXMuY3VycmVudFByaWNlOw0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsNCiAgICAgIHRoaXMuaXNDb25maXJtZWQgPSBmYWxzZTsNCiAgICAgIHRoaXMuaXNDb21wbGV0ZWQgPSBmYWxzZTsNCiAgICB9LA0KICAgIGF1dG9QcmljZSh2YWx1ZSkgew0KICAgICAgaWYgKHZhbHVlKSB0aGlzLnByaWNlID0gdGhpcy5jdXJyZW50UHJpY2U7DQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIGNvbnN0IGRhaUFkZHJlc3MgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0RBSV9BRERSRVNTOw0KICAgIGNvbnN0IGRhaUFsbG93YW5jZSA9IHBhcnNlRmxvYXQodGhpcy5zZXR0aW5ncy5hbGxvd2FuY2VzW2RhaUFkZHJlc3NdIHx8ICcwJyk7DQogICAgdGhpcy5pc0FwcHJvdmVkID0gISFkYWlBbGxvd2FuY2U7DQogIH0NCn07DQo="},{"version":3,"sources":["MakePotion.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0FA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MakePotion.vue","sourceRoot":"src/components/Modal","sourcesContent":["<template>\r\n  <Modal :open=\"open\" @close=\"$emit('close')\">\r\n    <div class=\"modal-body px-4\">\r\n      <div v-if=\"!isConfirmed\">\r\n        <h2 class=\"mb-5\">Your recipe</h2>\r\n        <div class=\"text-left\">\r\n          <div class=\"border-bottom mb-5\">\r\n            <div class=\"mb-4\">\r\n              Strike price<span class=\"float-right\">${{ $n(form.strike) }}</span>\r\n            </div>\r\n            <div class=\"mb-4\">\r\n              Expiry date\r\n              <span class=\"float-right\" v-text=\"form.expiry\" />\r\n            </div>\r\n            <div class=\"mb-4\">\r\n              Asset\r\n              <Ticker class=\"float-right\" :id=\"form.asset\" />\r\n            </div>\r\n            <div class=\"mb-3\">\r\n              Auto price\r\n              <span class=\"float-right\">\r\n                <VueSwitch v-model=\"autoPrice\" />\r\n              </span>\r\n            </div>\r\n            <div class=\"mb-5\">\r\n              <input\r\n                :readonly=\"autoPrice\"\r\n                type=\"number\"\r\n                class=\"input mb-3\"\r\n                placeholder=\"Price\"\r\n                v-model=\"price\"\r\n              />\r\n              <h6 v-if=\"!autoPrice\">\r\n                Using non-market prices may result in losses.\r\n                <a\r\n                  href=\"https://potion.gitbook.io/docs/exercising-a-potion/buying-a-potion\"\r\n                  target=\"_blank\"\r\n                >\r\n                  Learn more\r\n                </a>\r\n              </h6>\r\n            </div>\r\n          </div>\r\n          <div class=\"mb-4\">\r\n            Quantity<span class=\"float-right\">{{ $n(form.quantity) }}</span>\r\n          </div>\r\n          <div class=\"mb-4\">\r\n            Deposit per potion<span class=\"float-right\">{{ $n(premiumDeposit) }} BUSD</span>\r\n          </div>\r\n          <div class=\"mb-5 text-bold text-primary\">\r\n            Total deposit<span class=\"float-right\"\r\n              >{{ $n(form.quantity * premiumDeposit) }} BUSD</span\r\n            >\r\n          </div>\r\n        </div>\r\n        <h2 class=\"mb-4\">Want to purchase?</h2>\r\n        <div class=\"d-flex mb-2\">\r\n          <button class=\"button button-outline col-6 mr-2\" @click=\"$emit('close')\">Cancel</button>\r\n          <button class=\"button button-primary col-6 ml-2\" @click=\"handleSubmit\">\r\n            <VueLoadingIndicator v-if=\"isLoading\" class=\"big\" />\r\n            <template v-else>\r\n              <template v-if=\"isApproved\">Confirm</template>\r\n              <template v-else>Unlock BUSD</template>\r\n            </template>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div v-else>\r\n        <h2 class=\"mb-5\">Mix, turn and pour</h2>\r\n        <VueLoadingIndicator class=\"loading-lg mb-5\" v-if=\"!isCompleted\" />\r\n        <img v-else src=\"~/@/assets/check.svg\" height=\"118\" class=\"mb-5\" />\r\n        <p class=\"mb-5\">\r\n          Potion for <Ticker :id=\"form.asset\" type=\"short\" class=\"ml-1\" /> at ${{\r\n            $n(form.strike)\r\n          }}\r\n          on {{ form.expiry }}\r\n        </p>\r\n        <h2 class=\"mb-5\" v-if=\"!isCompleted\">Wait for creationâ€¦</h2>\r\n        <h2 class=\"mb-5\" v-else>Potion created!</h2>\r\n        <div>\r\n          <a @click=\"$emit('close')\" class=\"col-6 button button-outline\">\r\n            Back to home\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </Modal>\r\n</template>\r\n\r\n<script>\r\nimport bs from 'black-scholes';\r\nimport { mapActions, mapState } from 'vuex';\r\nimport { getPremiumDeposit } from '../../helpers/utils';\r\n\r\nexport default {\r\n  props: ['open', 'form'],\r\n  data() {\r\n    return {\r\n      isCompleted: false,\r\n      isLoading: false,\r\n      isApproved: true,\r\n      isConfirmed: false,\r\n      autoPrice: true,\r\n      price: 0\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState(['settings']),\r\n    currentPrice() {\r\n      return this.settings.exchangeRates[this.form.asset] &&\r\n        this.settings.exchangeRates[this.form.asset].usd\r\n        ? this.settings.exchangeRates[this.form.asset].usd.toFixed(2)\r\n        : 0;\r\n    },\r\n    daysToExpiry() {\r\n      const oneDay = 24 * 60 * 60 * 1e3;\r\n      const [year, month, day] = this.form.expiry.split('-');\r\n      const today = new Date();\r\n      const expiryDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day) + 1);\r\n      return Math.round(Math.abs((today - expiryDate) / oneDay));\r\n    },\r\n    premiumDeposit() {\r\n      return getPremiumDeposit(this.form.strike, this.price, this.daysToExpiry);\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions(['login', 'approve', 'writeMintPotion', 'loadPotions']),\r\n    async handleSubmit() {\r\n      this.isLoading = true;\r\n      if (this.isApproved) {\r\n        this.isConfirmed = true;\r\n        this.isLoading = false;\r\n        const payload = {\r\n          asset: this.form.asset,\r\n          strike: this.form.strike,\r\n          expiry: this.form.expiry,\r\n          quantity: this.form.quantity,\r\n          price: this.price,\r\n          premium: this.premiumDeposit.toString()\r\n        };\r\n        await this.writeMintPotion(payload);\r\n        await this.loadPotions();\r\n        this.isCompleted = true;\r\n      } else {\r\n        await this.approve();\r\n        this.isApproved = true;\r\n        this.isLoading = false;\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    open() {\r\n      this.autoPrice = true;\r\n      this.price = this.currentPrice;\r\n      this.isLoading = false;\r\n      this.isConfirmed = false;\r\n      this.isCompleted = false;\r\n    },\r\n    autoPrice(value) {\r\n      if (value) this.price = this.currentPrice;\r\n    }\r\n  },\r\n  created() {\r\n    const daiAddress = process.env.VUE_APP_DAI_ADDRESS;\r\n    const daiAllowance = parseFloat(this.settings.allowances[daiAddress] || '0');\r\n    this.isApproved = !!daiAllowance;\r\n  }\r\n};\r\n</script>\r\n"]}]}